# Введение
**Задание:**
> Попробовать взломать nginx другой команды. Проверить минимум три уязвимости - например path traversal, перебор страниц через ffuf и/или любые другие на ваш выбор.
Взлом считается успешным, если вы попали туда, куда не планировалось попадать пользователю, даже если там ничего нет. Успешность взлома не влияет на оценку лаб обеих команд. 

>В отчет приложить скрины попыток взлома, описание уязвимостей, на которые проверяли и итог - успешен взлом или нет.

> Тк открывать такие нжинксы в интернет не лучшая идея, для решения лабы предлагаю либо встретиться с другой командой в одном помещении и поднять локальную сеть, либо запустить у себя нжинкс с их конфигом. Но при этом настройки нжинкс со стороны админа и изменения в конфиге считаться попыткой взлома не будут.
Просьба договориться с другими командами кто кого ломает. Взлом нжинкса одной команды не должен фигурировать в отчетах больше двух раз.

Была взята работа команды [Ёжиков в тумане](https://github.com/DanilRozhin/Clouds-DevOps/tree/main/DevOps%20-%20LAB%201).

# Конфигурация проекта в своей среде

Из-за сложной конфигурации моего домашнего сервера, перенести конфигурационные файлы Ёжиков - не прямолинейная задача. Из-за сжатых сроков я настроила его как свои обычные сайты по шаблону - точка входа на виртуальном сервере portal с сертификатами, 
и сам конфигурационный файл и статичные файлы сервера на yetti.

Конфиг nginx на yetti:

```
server {
        listen 80;
        server_name _;
        root /var/www/project1;
        index index.htm index.html index.nginx-debian.html;
        location /i/ {
                alias /var/www/images/;
        }
        location / {
          try_files $uri $uri/ =404;
        }

}
```
Тем самым я временно открыла сайт https://nginxlab.plida.ru:

![alt text](<../images/nginx1.png>)

В целом, изменение структуры не должно было повлять на результаты работы. Какие же они?

# Эксплойты

## Абьюз мисконфигурации root и location nginx

Я закрою глаза на то, что я видела этот конфиг, и проверю базу: мы случайно не находимся в /etc/nginx? Если у команды не прописано нигде location /, то можно и nginx.conf стырить!

![alt text](<../images/nginx2.jpg>)

Ну, блин. Он выдаёт ошибку 404, а значит, меня всё же туда редиректят.

Загляним в конфиг, и действительно:

```
location / {
          try_files $uri $uri/ =404;
        }
```

Ну, можно ещё попробовать что-то потырить, конечно, но забегая вперёд - в их корневой папке нет ничего примечательного. Что так и должно быть! Если я в /var/www/project1 загружу секретик, и попробую его курлнуть...

![alt text](<../images/nginx3.jpg>)

Фантастика, он мой! Муа-ха-ха-ха! 

<img src="../images/3.png" alt="drawing" width="300"/>

Но, очевидно, это не вина ёжиков... 

Хм...

Мораль: если вы предоставляете доступ к запросам на корневой путь, и храните секретные файлы там, то?.. у пользователь есть доступ к этим файлам?..

Поговорим о чём-то более умном.

## Off-By-Slash мисконфигурация

Здесь придётся считерить - я заранее знаю, что у ёжиков есть алиас для локации "i", и что у них в пути алиаса есть папки проекта 1 и 2.

Off-By-Slash - мисконфигурация, где забывают поставить слэш в конце назначении локации. От того и имя. Благодаря чему можно сделать запрос "сайт/{имя локации}../файл_другой_папки" - в случае с ёжиками я бы смогла так подняться в папку /var/www/ и вытащить файлы из папок project1 и project2. Получится ли?

![alt text](<../images/nginx4.jpg>)


<img src="../images/2(1).png" alt="drawing" width="300"/>

Посмотрим в конфиг, они слэши не забыли поставить:

```
location /i/ {
                alias /var/www/images/;
        }
```

## FFuF

Я огорчена, я растроена, я хочу найти ~несуществующие~ секретики - я достаю пушку. FFuF перебирает все возможные пути "сайт/FUZZ", где он заменяет FUZZ словами, предоставленными пользователем.

[56к слов хватит?](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/raft-medium-words-lowercase.txt)

Хватит! Запускаем ```ffuf -w wordlist.txt -u https://nginxlab.plida.ru/FUZZ -ac```, сейчас все секретики найдём.....

![alt text](<../images/nginx5.jpg>)

...Он ничего не нашёл. Он даже /i/ не нашёл, потому что тот ведёт на страницу 404.

<img src="../images/2.png" alt="drawing" width="300"/>

## Бонус: тестирование ab load

Относится ли это как-то к теме лабораторной работы? Не особо, но я хочу хоть что-то сделать с этим сайтом. Я хочу вд

Вот так выглядят процессы контейнера в обычном состоянии:

![alt text](<../images/htop2.jpg>)

1000 запросов, 100 за раз:
```
ab -n 1000 -c 100 https://nginxlab.plida.ru/
```

Запускаем.

![alt text](<../images/htop1.jpg>)

Ха. Целых +2 процента нагрузки! На мой же сервер! Ха-ха-ха-ха!

<img src="../images/3.png" alt="drawing" width="300"/>

# Выводы

Шутки в сторону, мисконфигурация nginx файлов - дело частое. Не теряем слэши, следим за тем, к каким папкам даём доступ, не храним секретные файлы в доступных местах. А ёжики молодцы, что ничего не потеряли и правильно расставили локации.


<img src="../images/1(1).png" alt="drawing" width="300"/>
